<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <record id="call_channels_action" model="ir.actions.act_window">
    <field name="name">Call Channels</field>
    <field name="res_model">asterisk_plus.channel</field>
    <field name="view_mode">tree,form</field>
    <field name="domain">[('call', '=', active_id)]</field>
  </record>

  <record id="asterisk_plus_active_calls_action" model="ir.actions.act_window">
    <field name="name">Active Calls</field>
    <field name="res_model">asterisk_plus.call</field>
    <field name="view_mode">tree,form</field>
    <field name="domain">[('is_active', '=', True)]</field>
  </record>

  <record id="asterisk_plus_calls_history_action" model="ir.actions.act_window">
    <field name="name">Calls History</field>
    <field name="res_model">asterisk_plus.call</field>
    <field name="view_mode">tree,form</field>
    <field name="domain">[('is_active', '=', False)]</field>
  </record>

  <menuitem id="asterisk_plus_active_calls_menu"
            sequence="100"
            parent="asterisk_plus.asterisk_apps_menu"
            name="Active Calls"
            action="asterisk_plus_active_calls_action"/>

  <menuitem id="asterisk_plus_calls_history_menu"
            sequence="200"
            parent="asterisk_plus.asterisk_apps_menu"
            name="Calls History"
            action="asterisk_plus_calls_history_action"/>

  <record id="asterisk_plus_call_list" model="ir.ui.view">
    <field name="name">asterisk_plus_call_list</field>
    <field name="model">asterisk_plus.call</field>
    <field name="arch" type="xml">
      <tree edit="false" create="false" duplicate="false">
        <field name="calling_number"/>
        <field name="calling_user"/>
        <field name="called_number"/>
        <field name="called_user"/>
        <field name="ref"/>
        <field name="status"/>
        <field name="ended"/>
        <field name="direction_icon"/>
      </tree>
    </field>
  </record>

  <record id="asterisk_plus_call_form" model="ir.ui.view">
    <field name="name">asterisk_plus_call_form</field>
    <field name="model">asterisk_plus.call</field>
    <field name="type">form</field>
    <field name="arch" type="xml">
      <form create='0' edit='0' duplicate='0'>
        <header>
          <field name="status" widget="statusbar"/>
        </header>
        <sheet>
          <div class="oe_button_box" name="button_box">
            <button attrs="{'invisible': [('direction', '=', 'in')]}"
                    class="oe_stat_button"
                    style="text-align: center; color: #7C7BAD">
              <span class="fa fa-phone fa-2x" title="Out"/>
              <span class="fa fa-arrow-right" title="Out"/>
            </button>
            <button attrs="{'invisible': [('direction', '=', 'out')]}"
                    class="oe_stat_button"
                    style="text-align: center; color: #7C7BAD">
              <span class="fa fa-phone fa-2x" title="In"/>
              <span class="fa fa-arrow-left" title="In"/>
            </button>
            <button class="oe_stat_button"
                    string="Channels"
                    icon="fa-list"
                    name="%(call_channels_action)d"
                    type="action"/>
          </div>
          <group>
            <group>
              <field name="calling_number"/>
              <field name="calling_user" attrs="{'invisible': [('calling_user', '=', False)]}"/>
              <field name="partner" attrs="{'invisible': [('partner', '=', False)]}"/>
              <field name="model" invisible="1"/>
              <field name="ref" attrs="{'invisible': ['|', ('ref', '=', False),('model','=', 'res.partner')]}"/>
              <field name="direction"/>
            </group>
            <group>
              <field name="called_number"/>
              <field name="called_user" attrs="{'invisible': [('called_user', '=', False)]}"/>
              <field name="started"/>
              <field name="answered"/>
              <field name="ended"/>
            </group>
          </group>
          <group>
            <field name="channels"
                attrs="{'invisible': [('channels', '=', [])]}">
              <tree>
                <field name="channel"/>
                <field name="cause_txt"/>
                <field name="exten"/>
                <field name="callerid_num"/>
                <field name="user"/>
              </tree>
            </field>
          </group>
        </sheet>
      </form>
    </field>
  </record>

  <record id="asterisk_plus_call_search" model="ir.ui.view">
    <field name="name">asterisk.plus.call.search</field>
    <field name="model">asterisk_plus.call</field>
    <field name="arch" type="xml">
      <search>
        <field name="calling_number"/>
        <field name="called_number"/>
        <field name="partner"/>
        <field name="calling_user"/>
        <field name="called_user"/>
        <field name="status"/>
        <field name="ended"/>
        <filter name="in" string="Incoming"
          domain="[('direction', '=', 'in')]"/>
        <filter name="out" string="Outgoing"
          domain="[('direction', '=', 'out')]"/>
          <filter name="by_status" string="Ended" context="{'group_by':'status'}"/>
        <filter name="by_ended" string="Ended" context="{'group_by':'ended'}"/>
        <filter name="by_direction" string="Ended" context="{'group_by':'direction'}"/>
        <filter name="by_partner" string="Partner" context="{'group_by':'partner'}"/>
        <filter name="by_calling_user" string="Calling User" context="{'group_by':'calling_user'}"/>
        <filter name="by_called_user" string="Called User" context="{'group_by':'called_user'}"/>
      </search>
    </field>
  </record>
  
  <!-- 'Move to History' in action dropdown -->
  <record id="call_move_to_history_action" model="ir.actions.server">
    <field name="name">Move to History</field>
    <field name="model_id" ref="model_asterisk_plus_call"/>
    <field name="binding_model_id" ref="asterisk_plus.model_asterisk_plus_call"/>
    <field name="binding_view_types">list,form</field>
    <field name="state">code</field>
    <field name="code">
        for record in records:
            record.move_to_history()
    </field>
  </record>

</odoo>
